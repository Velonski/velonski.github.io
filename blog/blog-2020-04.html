<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="author" content="Mikhail Eremeev aka Velonski">
        <meta name="description" content="Личный Интернет-сайт Михаила Еремеева: блог за апрель 2020 г.">
        <meta name="keywords" content="михаил еремеев velonski личный сайт блог апрель 2020">
        <meta name="referrer" content="origin">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <title>Velonski.ru - Блог за апрель 2020 года</title>
    </head>
    <body>
        <a href="../index.html">velonski.ru</a>

        <h1>Записи блога за апрель 2020 года</h1>

        <ul>
            <li>
                <h3 id="note_1">Монтирование сетевых каталогов в ОС Linux через sshfs</h3>
                <small>13.04.2020</small>
                <p>
                    Программа sshfs облегчает работу с файлами по сети: файловую систему удалённого компьютера можно подключить как обычный каталог на своём жёстком диске.
                </p>
                <p>
                    Сейчас sshfs доступна практически в любом дистрибутиве ОС Linux, в котором есть набор утилит OpenSSH. В дистрибутивах, основанных на операционной системе Debian, установить sshfs можно такой командой в терминале:
                </p>
                <p>
                    <pre>
<code>
apt-get install sshfs

или

sudo apt-get install sshfs
</code>
                    </pre>
                </p>
                <p>
                    Всегда, когда я подключаю сетевой каталог через sshfs, я хочу, чтобы подключение к этому каталогу оставалось "живым" до тех пор, пока я сам не выполню команду для отмены монтирования. Однако в некоторых случаях, соединение с сетевым ресурсом сбрасывается. Это может происходить, если компьютер перешёл в состояние "сна" или пользователь долго не выполнял никаких операций с файлами сетевого каталога.
                </p>
                <p>
                    Чтобы такая проблема не возникала, надо выполнить подключение сетевого каталога с дополнительными параметрами. Я использую такую команду:
                    <pre>
<code>
sshfs host:/some/dir/ /mount/dir/ -o reconnect,ServerAliveInterval=15,ServerAliveCountMax=3
</code>
                    </pre>
                </p>
                <p>
                    Также можно прописать эти параметры в настройках ssh-подключений, которые обычно хранятся в файле ~/.ssh/config. Мои параметры ssh-подключения к смартфону выглядят так:
                    <pre>
<code>
Host phone
HostName 192.168.0.101
Port 8022
User user_name
IdentityFile ~/ssh-keys/phone-key
ServerAliveInterval 15
ServerAliveCountMax 3
</code>
                    </pre>
                    Соответственно, при наличии такой конфигурации для подключения сетевого каталога надо использовать такую команду:
                    <pre>
<code>
sshfs phone:/some/dir/ /mount/dir/ -o reconnect
</code>
                    </pre>
                </p>
                <p>
                    Я столкнулся с проблемой "сброса" соединения sshfs, когда работал в ОС Puppy Linux: программа, через которую я работал с файлами sshfs-каталога, просто зависала и находилась в таком состоянии бесконечно долгое время. Такое происходило с текстовым редактором Geany и эмулятором терминала lxterminal.
                </p>
                <p>
                    Чтобы решить проблему, надо отключить сетевой каталог. Помогает след. последовательность команд:
                    <pre>
<code>
umount -f /mount/dir
umount /mount/dir
</code>
                    </pre>
                    Сначала обязательно надо выполнить команду umount с параметром -f, иначе командная оболочка "зависнет" так же, как и другие программы.
                </p>
                <p>
                    У меня пока ни разу не зависало sshfs-подключение в ОС Debian (тоже Linux). Возможно, базовые настройки ssh-клиента в этой ОС уже содержат параметры, которые помогают удерживат sshfs-подключение и не допускать сбоев.
                </p>
            </li>
        </ul>
    </body>
</html>
